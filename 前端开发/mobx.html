<!DOCTYPE html><html lang="en"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="author" content="qoxop">
    <meta name="keywords" content="">
    <meta name="description" content="参数：一个使用了observable数据的函数">
    <link rel="stylesheet" href="/assets/style/index.css">
    <title>mobx</title>
<link rel="stylesheet" href="/assets/code_styles/solarized-light.css"></head>
<body>
    <header>
        <div class="header">
            <h1><a class="unset" href="/">阿伟的网络日志</a></h1>
            <nav>
                <ul>
                    <li>
                        <a class="unset" href="/index.html">Home</a>
                    </li>
                    <li>
                        <a class="unset" href="/tags.html">Tags</a>
                    </li>
                    <li>
                        <a class="unset" href="/about.html">About</a>
                    </li>
                </ul>
            </nav>
        </div>
    </header>
    <main>
        <article id="article_main"><h1>mobx</h1><section class="article_info">
        <span class="author">author: qoxop</span>
        <span class="update_time">update at: 2017-11-26</span>
    </section><div class="from_markdown"><h4 id="autorun">Autorun</h4>
<p>参数：一个使用了observable数据的函数</p>
<p>返回：disposer函数，调用该函数可以去取消autorun，以及取消对computed值的计算</p>
<p>错误处理：可以用disposer.onError方法来覆盖Reaction的默认日志行为。</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">const</span> age = observable(<span class="hljs-number">10</span>)
<span class="hljs-keyword">const</span> dispose = autorun(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
    <span class="hljs-keyword">if</span> (age.get() &lt; <span class="hljs-number">0</span>)
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Age should not be negative"</span>)
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Age"</span>, age.get())
})
age.set(<span class="hljs-number">18</span>)  <span class="hljs-comment">// 输出: Age 18</span>
age.set(<span class="hljs-number">-10</span>) <span class="hljs-comment">// 输出: Age should not be negative</span>
age.set(<span class="hljs-number">5</span>)   <span class="hljs-comment">// 已恢复; 输出: Age 5</span>

dispose.onError(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> {
    <span class="hljs-built_in">window</span>.alert(<span class="hljs-string">"Please enter a valid age"</span>)
})

age.set(<span class="hljs-number">-5</span>)  <span class="hljs-comment">// 显示alert弹出框</span>
</code></pre>
<p>全局的onError方法：全局的 onError 处理方法可以通过 extras.onReactionError(handler)来设置。</p>
<p><img src="/images/icon.png" alt="icon"></p>
<h4 id="%40observer">@observer</h4>
<p>将React组件转变成响应式组件。它用mobx.autorun 包装了组件的render函数以确保任何组件渲染中使用的数据变化是都可以强制刷新组件。</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">import</span> {observer} <span class="hljs-keyword">from</span> <span class="hljs-string">"mobx-react"</span>;

<span class="hljs-keyword">var</span> timerData = observable({
    <span class="hljs-attr">secondsPassed</span>: <span class="hljs-number">0</span>
});

setInterval(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
    timerData.secondsPassed++;
}, <span class="hljs-number">1000</span>);

@observer <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Timer</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>{
    render() {
        <span class="hljs-keyword">return</span> (<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>Seconds passed: { this.props.timerData.secondsPassed } <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span> )
    }
};
<span class="hljs-comment">//secondsPassed改变会触发组件刷新</span>
React.render(&lt;Timer timerData={timerData} /&gt;, document.body);
/*secondsPassed改变不会触发组件刷新，因为此处只是单纯地传递了字面值而已，Timer无法获取到timerData.secondsPassed的变化*/
React.render(&lt;Timer timerData={timerData.secondsPassed} /&gt;, document.body); 
</code></pre>
<p>@observer、autorun函数所能观察的目标只能是引用，为了触发 **autorun **值需要通过引用来传递而不是字面值来传递。</p>
<ol>
<li>
<p>无状态函数组件</p>
<pre><code class="hljs language-react">import {observer} from "mobx-react";

const Timer = observer(({ timerData }) =&gt;
    &lt;span&gt;Seconds passed: { timerData.secondsPassed } &lt;/span&gt;
);
</code></pre>
</li>
<li>
<p>可观察的局部组件状态</p>
<pre><code class="hljs language-react">import {observer} from "mobx-react"
import {observable} from "mobx"

@observer class Timer extends React.Component {
    @observable secondsPassed = 0

    componentWillMount() {
        setInterval(() =&gt; {
            this.secondsPassed++
        }, 1000)
    }

    render() {
        return (&lt;span&gt;Seconds passed: { this.secondsPassed } &lt;/span&gt; )
    }
})

React.render(&lt;Timer /&gt;, document.body)
</code></pre>
<p>mobx局部组件状态的变化只会触发render、componentWillUpdate、componentDidUpdate</p>
</li>
<li>
<p>componentWillReact 生命周期钩子</p>
<p>当使用 mobx-react 时可以定义一个新的生命周期钩子函数 componentWillReact(一语双关)。当组件因为它观察的数据发生了改变，它会安排重新渲染，这个时候 componentWillReact 会被触发。</p>
<h4 id="action">action</h4>
<p>应该永远只对<strong>修改</strong>状态的函数使用动作</p>
<ul>
<li>
<p>绑定的动作</p>
<pre><code class="hljs language-react">class Ticker {
    @observable tick = 0

    @action.bound
    increment() {
        this.tick++ // 'this' 永远都是正确的
    }
}
</code></pre>
</li>
</ul>
</li>
</ol>
<h4 id="mobx%E4%BC%9A%E5%AF%B9%E4%BB%80%E4%B9%88%E5%81%9A%E5%87%BA%E5%8F%8D%E5%BA%94%EF%BC%9F">Mobx会对什么做出反应？</h4>
<blockquote>
<p>Mobx 会对在<strong>追踪函数</strong>执行过程中<strong>读取</strong>现存的可观察属性做出反应。</p>
</blockquote>
<p>调用过至少一次getter(注册观察者)，使用setter(执行过程)</p>
<p>Mobx的observable函数就是通过普通对象生产一个拥有getter、setter属性的对象，其中getter的首次调用用于初始化初值并注册该属性的观察者，</p>
<p>单例模式、观察者模式</p>
</div><section class="tags_bar"><a href="/tags.html#mobx">mobx</a><a href="/tags.html#状态管理">状态管理</a></section></article>
        <aside> 
            <section class="assist-tool">
                <div class="back-to-top">
                    <em class="iconfont icon-top"></em>
                </div>
            </section>
        </aside>
    </main>
    <footer>
        <div class="scrollTips" id="scrollTips">
        </div>
        <section class="copyright">
            copyright © 2019 by zhangjiwei
        </section>
        <section class="ICP_NUM">
            <a href="http://www.miitbeian.gov.cn">
                粤ICP备19026817号-1
            </a>
        </section>
    </footer>
    <script src="/assets/script/common.js"></script>


<script src="/assets/script/article.js"></script></body></html>