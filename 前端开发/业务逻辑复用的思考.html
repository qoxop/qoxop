<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="keywords" content="">
    <title>qoxop | 业务逻辑复用的思考</title>
    <link rel="stylesheet" href="/assets/common.css">
    <link rel="stylesheet" href="/assets/article.css">
    <link href="/assets/monokai_sublime.min.css" rel="stylesheet">  
    <script async src="/assets/highlight.min.js"></script>
    
</head>
<body>
    <article id="app">
        <header id="app_header">
          <h1>张集伟的个人博客</h1>
          <div class="content_box header_inner">
            <div class="logo">
              <div class="logoImg">
                <img src="/assets/icon.png" alt="">
              </div>
              <div class="logoText">
                jiw
              </div>
            </div>
            <nav class="navigator">
              <ul>
                
                <li class="" onclick="exec('linkTo', '/index.html')">
                    <a href="/index.html">
                        HOME
                    </a>
                </li>
                
                <li class="" onclick="exec('linkTo', '/category.html')">
                    <a href="/category.html">
                        CATEGORY
                    </a>
                </li>
                
                <li class="" onclick="exec('linkTo', '/tags.html')">
                    <a href="/tags.html">
                        标签
                    </a>
                </li>
                
                <li class="" onclick="exec('linkTo', '/link.html')">
                    <a href="/link.html">
                        链接
                    </a>
                </li>
                
                <li class="" onclick="exec('linkTo', '/about.html')">
                    <a href="/about.html">
                        关于我
                    </a>
                </li>
                
              </ul>
            </nav>
          </div>
        </header>
        <main id="main">
           <article class="content_box">
    <div class="article md_html_article" id="left_content">
        <h1>
            业务逻辑复用的思考
        </h1>
        <div class="update_time">
            <span>
                更新时间：2019-03-03
            </span>
        </div>
        <div id="write" class="md_essay">
            <p>最近在改需求的过程中遇到一些一些比较无奈的情况，让人改期代码来颇为xx，一个接口没有统一处理问题，另一一个redux的使用问题，这两个问题导致了同样的结果——业务逻辑难以复用和数据源不唯一</p>
<!-- more -->
<h3 id="%E9%97%AE%E9%A2%981%EF%BC%9A%E6%8E%A5%E5%8F%A3%E6%B2%A1%E6%9C%89%E7%BB%9F%E4%B8%80%E5%A4%84%E7%90%86">问题1：接口没有统一处理</h3>
<p>接口没有统一处理请求逻辑，同一个接口在不同的页面都用到了，而它们的数据展示也是一样UI效果，虽然展示组件做了复用，但是接口请求却是各自管理的，这样一来导致了接口的改动需要，处理好几个地方，如果对业务不是非常了解的情况下常常会发生遗漏，导致了严重的bug。</p>
<h3 id="%E9%97%AE%E9%A2%98%E4%BA%8C%EF%BC%9A%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E4%B8%8D%E5%A5%BD%E5%A4%8D%E7%94%A8%E6%95%B0%E6%8D%AE%E6%BA%90%E4%B8%8D%E7%BB%9F%E4%B8%80">问题二：业务逻辑不好复用数据源不统一</h3>
<p>先说一下项目中使用redux的风格(技术背景)：</p>
<blockquote>
<ol>
<li>接口请求到的业务数据一般保存到了redux中，之前问过相关的前辈，给出的解释是&quot;在请求还没返回之前页面能用旧数据的来填充页面，减少页面loading，但也能保证数据的实时性&quot;。</li>
<li>reducer是通过路由的方式动态注入的，而大部分的业务逻辑处理也是以页面组件单位来处理的，也就是说reducer定义了整个页面可能用到的所有业务数据，所以业务逻辑与页面组件存在很强的耦合。</li>
</ol>
</blockquote>
<p>然后讲一讲遇到的问题</p>
<blockquote>
<p>用一个栗子的方式来说，A页面展示了两个接口的业务数据api_1, api_2,  现在B页面也需要去那api_1接口的数据来展示其中存在的只有部分参数的差异。因为不管是展示方式还是逻辑处理实在是存在很多的相同的地方，所以第一时间想到的是复用，以最小的改动完成B页面的需求，但是实际上原有的代码中遇到这种情况基本只是做到了展示组件的复用，其他的包括action、reducer的定义以及接口的封装都是各写一份。但我个人认为这应该是算是一种严重的浪费。</p>
</blockquote>
<h3 id="%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3">如何解决</h3>
<p>这里主要讲一下解决问题的思路。想复用reducer，不想将相同的业务数据定义在了不同的地方，但是由于reducer与页面耦合性强，简单的将state和actionCreator链接(connect)到页面组件显然不好，原因有二，一个是存在性问题，一个代码结构会变混乱。所以首先要做必然是通用业务与页面的解耦，将通用业务和其展示组件封装成一个可插拔的业务组件，组件使用只需控制接口参数的差异变可以控制组件的展示而无需在意其接口的调用，而组件内的变化也可通过回调的方式通知给使用者。这样一来便可以解决上面提到的两个问题</p>
<p>实现这个思路我能想到的有两种方式，一个是业务组件的reducer、action等定义往上层抽离，做到与页面无关，另一个很简单，就是不用redux存储业务数据而是采用react提供的state。</p>

        </div>
        <div class="md_essay_tags">
            
        </div>
    </div>
</article>
        </main>
        <footer id="footer"></footer>
      </article>
      <div class="shortcut-tools">
          <div onclick="exec('scrollToTop')" class="goto-top-btn">Top</div>
          <div onclick="exec('scrollToBottom')" class="goto-bottom-btn">Bottom</div>
          <div onclick="exec('goback')" class="goback-btn">goback</div>
      </div>
      <script src="/assets/common.js"></script>
</body>
</html>